<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>PlayerJS</title>
	<style>
		html, body {
			margin: 0;
			padding: 0;
			width: 100%;
			height: 100%;
		}
	</style>
</head>
<body>
	<div id="playerjs"></div>
	<script src="https://cdn.jsdelivr.net/gh/OinkTechLtd/cdnplayerjs@main/playerjs.js"></script>
	<script>
		var ps = location.href.substr(location.href.indexOf("html?") + 5).split("&");
		var vs = { id: "playerjs" };

		for (var i = 0; i < ps.length; i++) {
			var p = ps[i].split("=");
			vs[decodeURIComponent(p[0])] = decodeURIComponent(p[1]);
		}

		if (vs.file) {
			vs.file = decodeURIComponent(vs.file);
		}

		// Если плейлист - используем API для парсинга
		if (vs.file && vs.file.toLowerCase().includes('.m3u')) {
			fetch('/api/playlist?url=' + encodeURIComponent(vs.file))
				.then(r => r.json())
				.then(data => {
					if (data.playlist && data.playlist.length > 0) {
						// Преобразуем плейлист с поддержкой логотипов
						vs.playlist = data.playlist.map(function(item) {
							return {
								title: item.title,
								file: item.file,
								image: item.image || undefined,
								poster: item.image || undefined
							};
						});
						vs.file = data.playlist[0].file;
						vs.poster = data.playlist[0].image || undefined;
					}
					console.log('[v0] Playlist loaded, creating player');
					new Playerjs(vs);
				})
				.catch(function(err) {
					console.error('[v0] Playlist error:', err);
					new Playerjs(vs);
				});
		} else if (vs.file) {
			// Файл - проксируем потоки через наш API для обхода блокировок
			console.log('[v0] Single file, proxying');
			vs.file = '/api/proxy?url=' + encodeURIComponent(vs.file);
			new Playerjs(vs);
		} else {
			new Playerjs(vs);
		}
	</script>
</body>
</html>
