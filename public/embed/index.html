<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>PlayerJS</title>
	<style>
		html, body {
			margin: 0;
			padding: 0;
			width: 100%;
			height: 100%;
		}
	</style>
</head>
<body>
	<div id="playerjs"></div>
	<script src="https://cdn.jsdelivr.net/gh/OinkTechLtd/cdnplayerjs@main/playerjs.js"></script>
	<script>
		var ps = location.href.substr(location.href.indexOf("html?") + 5).split("&");
		var vs = { id: "playerjs" };

		for (var i = 0; i < ps.length; i++) {
			var p = ps[i].split("=");
			vs[decodeURIComponent(p[0])] = decodeURIComponent(p[1]);
		}

		if (vs.file) {
			vs.file = decodeURIComponent(vs.file);
		}

		// Если плейлист - используем API
		if (vs.file && vs.file.toLowerCase().includes('.m3u')) {
			fetch('/api/playlist?url=' + encodeURIComponent(vs.file))
				.then(r => r.json())
				.then(data => {
					if (data.playlist && data.playlist.length > 0) {
						vs.playlist = data.playlist;
						vs.file = data.playlist[0].file;
					}
					new Playerjs(vs);
				})
				.catch(() => new Playerjs(vs));
		} else {
			// Если PHP скрипт или локальная ссылка - проксируем
			if (vs.file && (vs.file.includes('.php') || vs.file.match(/^https?:\/\/(localhost|127|192|10)/))) {
				vs.file = '/api/stream?url=' + encodeURIComponent(vs.file);
			}
			new Playerjs(vs);
		}
	</script>
</body>
</html>
